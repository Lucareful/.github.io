<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>12306自动化抢票实现 | Luenci</title>
<meta name="keywords" content="selenium">
<meta name="description" content="selenium常用API

find_element_by_xxx  返回第一个符合条件WebElement元素
find_elements_by_xxx  返回符合条件所有元素包含了 WebEelemnt 列表




函数
作用




find_element_by_class_name
通过class查询元素


find_element_by_id
通过ID查询元素


find_element_by_name
通过name查询元素


find_element_by_tag_name
通过标签名称


find_element_by_css_selector
css样式选择


find_element_by_link_text
通过链接内容查找


find_element_by_partial_link_text
通过链接内容包含的内容查找，模糊查询


find_element_by_xpath
通过xpath查找数据



获取元素属性和文本内容


1
2
3
4
5
6
7
8


#获取属性
element.get_attribute（&#39;属性名”）
#获取文本内容
element.text
# 输入框输入内容
input_element.send_keys（&#39;Luenci&#39;）
# 元素点击
element.click()


三种等待方式

当控制浏览器时，浏览器正在加载页面同时又去获取数据导致浏览器寻找不到需要操作的元素引发异常。
方式一：强制等待，浪费时间

time.sleep（秒数）


方式二：隐性等待，无法控制Ajax请求

browser.implicit1y_wait（等待时间）


方式三：显性等待，每个元素都可以自己定义检查条件。手动编写方式



 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15


#显性等待-手动编写
t = time.time（）
#定义超时时间
timeout = 60
while True：
	try：
        #超时时间间隔
        time.sleep（0.1）
        ur1_element = browser.find_element_by_class_name（&#34;fav ur1&#34;）
		break 
	except：
        #超时处理
        if time.time（）- t &gt; timeout：
        	break 
		pass


系统提供显性等待API


 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18


# 导入显性等待的API需要的模块
# 1等待对象模块
from selenium.webdriver.support.wait import WebDriverwait
# 2导入等待条件模块
from selenium.webdriver.support import expected_conditions as EC
# 3导入查询元素模块
from selenium.webdriver.common.by import By

# 1.创建等待对象
# 参数一浏览器对象
# 参数二超时时间
# 参数三检查元素时间间隔
wait = WebDriverwait（browser，5.0，0.5）
# 2.通过等待对象获取元素
# presence_of_element_located 检查元素是否存在，如果存在就返回如果不存在就继续检查
# visibility_of_element_located 检查元素是否可见
linkelement = s wait.until（EC.presence_of_element_located（（By.CLASS_NAME，&#34;favurl&#34;）
link_element.click（）


12306爬虫实现
完成代码见：https://github.com/Lucareful/12306_Tickets

实现步骤

1.访问列表页
2.通过时间判定选择点击预订
3.点击账号登录
4.输入用户名和密码（15523750230）
5.截图获取验证码图片
6.发送打码平台获取识别数字
7.定义8个点击坐标
8.模拟点击坐标
9.点击登录
10.点击选择人物
11.点击提交订单
12.点击确认订单


">
<meta name="author" content="Luenci">
<link rel="canonical" href="http://localhost:1313/articles/1/01/12306%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8A%A2%E7%A5%A8%E5%AE%9E%E7%8E%B0/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.54405a410796490bc874ab6181fac9b675753cc2b91375d8f882566459eca428.css" integrity="sha256-VEBaQQeWSQvIdKthgfrJtnV1PMK5E3XY&#43;IJWZFnspCg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/articles/1/01/12306%E8%87%AA%E5%8A%A8%E5%8C%96%E6%8A%A2%E7%A5%A8%E5%AE%9E%E7%8E%B0/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Luenci (Alt + H)">Luenci</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/index.xml" title="RSS Feed">
                    <span>RSS Feed</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      12306自动化抢票实现
    </h1>
    <div class="post-meta">Luenci

</div>
  </header> 
  <div class="post-content"><h1 id="selenium常用api">selenium常用API<a hidden class="anchor" aria-hidden="true" href="#selenium常用api">#</a></h1>
<ul>
<li><code>find_element_by_xxx</code>  返回第一个符合条件<code>WebElement</code>元素</li>
<li><code>find_elements_by_xxx</code>  返回符合条件所有元素包含了 <code>WebEelemnt </code>列表</li>
</ul>
<table>
<thead>
<tr>
<th>函数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>find_element_by_class_name</td>
<td>通过class查询元素</td>
</tr>
<tr>
<td>find_element_by_id</td>
<td>通过ID查询元素</td>
</tr>
<tr>
<td>find_element_by_name</td>
<td>通过name查询元素</td>
</tr>
<tr>
<td>find_element_by_tag_name</td>
<td>通过标签名称</td>
</tr>
<tr>
<td>find_element_by_css_selector</td>
<td>css样式选择</td>
</tr>
<tr>
<td>find_element_by_link_text</td>
<td>通过链接内容查找</td>
</tr>
<tr>
<td>find_element_by_partial_link_text</td>
<td>通过链接内容包含的内容查找，模糊查询</td>
</tr>
<tr>
<td>find_element_by_xpath</td>
<td>通过xpath查找数据</td>
</tr>
</tbody>
</table>
<h1 id="获取元素属性和文本内容">获取元素属性和文本内容<a hidden class="anchor" aria-hidden="true" href="#获取元素属性和文本内容">#</a></h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4">#获取属性</span>
</span></span><span style="display:flex;"><span>element<span style="color:#ff79c6">.</span>get_attribute（<span style="color:#f1fa8c">&#39;属性名”）</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#获取文本内容</span>
</span></span><span style="display:flex;"><span>element<span style="color:#ff79c6">.</span>text
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 输入框输入内容</span>
</span></span><span style="display:flex;"><span>input_element<span style="color:#ff79c6">.</span>send_keys（<span style="color:#f1fa8c">&#39;Luenci&#39;</span>）
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 元素点击</span>
</span></span><span style="display:flex;"><span>element<span style="color:#ff79c6">.</span>click()
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="三种等待方式">三种等待方式<a hidden class="anchor" aria-hidden="true" href="#三种等待方式">#</a></h2>
<ul>
<li>当控制浏览器时，浏览器正在加载页面同时又去获取数据导致浏览器寻找不到需要操作的元素引发异常。</li>
<li>方式一：强制等待，浪费时间
<ul>
<li><code>time.sleep（秒数）</code></li>
</ul>
</li>
<li>方式二：隐性等待，无法控制Ajax请求
<ul>
<li><code>browser.implicit1y_wait（等待时间）</code></li>
</ul>
</li>
<li>方式三：显性等待，每个元素都可以自己定义检查条件。手动编写方式</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4">#显性等待-手动编写</span>
</span></span><span style="display:flex;"><span>t <span style="color:#ff79c6">=</span> time<span style="color:#ff79c6">.</span>time（）
</span></span><span style="display:flex;"><span><span style="color:#6272a4">#定义超时时间</span>
</span></span><span style="display:flex;"><span>timeout <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">60</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">while</span> <span style="color:#ff79c6">True</span>：
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">try</span>：
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">#超时时间间隔</span>
</span></span><span style="display:flex;"><span>        time<span style="color:#ff79c6">.</span>sleep（<span style="color:#bd93f9">0.1</span>）
</span></span><span style="display:flex;"><span>        ur1_element <span style="color:#ff79c6">=</span> browser<span style="color:#ff79c6">.</span>find_element_by_class_name（<span style="color:#f1fa8c">&#34;fav ur1&#34;</span>）
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">break</span> 
</span></span><span style="display:flex;"><span>	<span style="color:#ff79c6">except</span>：
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">#超时处理</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> time<span style="color:#ff79c6">.</span>time（）<span style="color:#ff79c6">-</span> t <span style="color:#ff79c6">&gt;</span> timeout：
</span></span><span style="display:flex;"><span>        	<span style="color:#ff79c6">break</span> 
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">pass</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="系统提供显性等待api">系统提供显性等待API<a hidden class="anchor" aria-hidden="true" href="#系统提供显性等待api">#</a></h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4"># 导入显性等待的API需要的模块</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 1等待对象模块</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> selenium.webdriver.support.wait <span style="color:#ff79c6">import</span> WebDriverwait
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 2导入等待条件模块</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> selenium.webdriver.support <span style="color:#ff79c6">import</span> expected_conditions <span style="color:#ff79c6">as</span> EC
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 3导入查询元素模块</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> selenium.webdriver.common.by <span style="color:#ff79c6">import</span> By
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 1.创建等待对象</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 参数一浏览器对象</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 参数二超时时间</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 参数三检查元素时间间隔</span>
</span></span><span style="display:flex;"><span>wait <span style="color:#ff79c6">=</span> WebDriverwait（browser，<span style="color:#bd93f9">5.0</span>，<span style="color:#bd93f9">0.5</span>）
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 2.通过等待对象获取元素</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># presence_of_element_located 检查元素是否存在，如果存在就返回如果不存在就继续检查</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># visibility_of_element_located 检查元素是否可见</span>
</span></span><span style="display:flex;"><span>linkelement <span style="color:#ff79c6">=</span> s wait<span style="color:#ff79c6">.</span>until（EC<span style="color:#ff79c6">.</span>presence_of_element_located（（By<span style="color:#ff79c6">.</span>CLASS_NAME，<span style="color:#f1fa8c">&#34;favurl&#34;</span>）
</span></span><span style="display:flex;"><span>link_element<span style="color:#ff79c6">.</span>click（）
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="12306爬虫实现">12306爬虫实现<a hidden class="anchor" aria-hidden="true" href="#12306爬虫实现">#</a></h1>
<p>完成代码见：https://github.com/Lucareful/12306_Tickets</p>
<ul>
<li>实现步骤
<ul>
<li>1.访问列表页</li>
<li>2.通过时间判定选择点击预订</li>
<li>3.点击账号登录</li>
<li>4.输入用户名和密码（15523750230）</li>
<li>5.截图获取验证码图片</li>
<li>6.发送打码平台获取识别数字</li>
<li>7.定义8个点击坐标</li>
<li>8.模拟点击坐标</li>
<li>9.点击登录</li>
<li>10.点击选择人物</li>
<li>11.点击提交订单</li>
<li>12.点击确认订单</li>
</ul>
</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#6272a4"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> selenium <span style="color:#ff79c6">import</span> webdriver
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> selenium.webdriver <span style="color:#ff79c6">import</span> ActionChains
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> selenium.webdriver.support.wait <span style="color:#ff79c6">import</span> WebDriverWait
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> selenium.webdriver.support <span style="color:#ff79c6">import</span> expected_conditions <span style="color:#ff79c6">as</span> EC
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> selenium.webdriver.common.by <span style="color:#ff79c6">import</span> By
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> PIL <span style="color:#ff79c6">import</span> Image
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> io <span style="color:#ff79c6">import</span> BytesIO
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 判断YDMHTTP模块是否在python环境中（我的是不在，所以加上去）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sys<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>insert(<span style="color:#bd93f9">1</span>, <span style="color:#f1fa8c">r</span><span style="color:#f1fa8c">&#34;YDMHTTP.py&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">from</span> YDMHTTP <span style="color:#ff79c6">import</span> decode
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>browser <span style="color:#ff79c6">=</span> webdriver<span style="color:#ff79c6">.</span>Chrome()
</span></span><span style="display:flex;"><span>browser<span style="color:#ff79c6">.</span>maximize_window()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>linktypeid <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;dc&#34;</span>
</span></span><span style="display:flex;"><span>fs <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;北京&#34;</span>
</span></span><span style="display:flex;"><span>ts <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;武汉&#34;</span>
</span></span><span style="display:flex;"><span>date <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;2020-01-13&#34;</span>
</span></span><span style="display:flex;"><span>flag <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;N,N,Y&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>base_url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;https://kyfw.12306.cn/otn/leftTicket/init?linktypeid=</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&amp;fs=</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">,BJP&amp;ts=</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">,WHN&amp;date=</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&amp;flag=</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#39;</span>
</span></span><span style="display:flex;"><span>url <span style="color:#ff79c6">=</span> base_url<span style="color:#ff79c6">.</span>format(linktypeid, fs, ts, date, flag)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>browser<span style="color:#ff79c6">.</span>get(url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wait <span style="color:#ff79c6">=</span> WebDriverWait(browser, <span style="color:#bd93f9">10</span>, <span style="color:#bd93f9">0.5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 通过时间判定选择预定车次</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 寻找tr标签中的 属性id 已 ’ticket_‘ 开头的数据</span>
</span></span><span style="display:flex;"><span>tr_list <span style="color:#ff79c6">=</span> wait<span style="color:#ff79c6">.</span>until(EC<span style="color:#ff79c6">.</span>visibility_of_all_elements_located((By<span style="color:#ff79c6">.</span>XPATH, <span style="color:#f1fa8c">&#39;//tr[starts-with(@id, &#34;ticket_&#34;)]&#39;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> tr <span style="color:#ff79c6">in</span> tr_list:
</span></span><span style="display:flex;"><span>    date_string <span style="color:#ff79c6">=</span> tr<span style="color:#ff79c6">.</span>find_element_by_class_name(<span style="color:#f1fa8c">&#34;start-t&#34;</span>)<span style="color:#ff79c6">.</span>text
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 判断时间是否在符合你想要的时间范围中</span>
</span></span><span style="display:flex;"><span>    tr<span style="color:#ff79c6">.</span>find_element_by_class_name(<span style="color:#f1fa8c">&#39;no-br&#39;</span>)<span style="color:#ff79c6">.</span>click()
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># print(date_string)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 点击账号 异步加载需要显性等待</span>
</span></span><span style="display:flex;"><span>wait<span style="color:#ff79c6">.</span>until(EC<span style="color:#ff79c6">.</span>visibility_of_element_located((By<span style="color:#ff79c6">.</span>LINK_TEXT, <span style="color:#f1fa8c">&#34;账号登录&#34;</span>)))<span style="color:#ff79c6">.</span>click()
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># browser.find_element_by_link_text(&#34;账号登录&#34;).click()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 输入用户名和密码（我将我的用户名和密码保存在了json文件中，若别人使用需要更改）</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">with</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#34;account.json&#34;</span>, <span style="color:#f1fa8c">&#34;r&#34;</span>, encoding<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;utf-8&#34;</span>) <span style="color:#ff79c6">as</span> f:
</span></span><span style="display:flex;"><span>    account <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>load(f)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>browser<span style="color:#ff79c6">.</span>find_element_by_id(<span style="color:#f1fa8c">&#34;J-userName&#34;</span>)<span style="color:#ff79c6">.</span>send_keys(account[<span style="color:#f1fa8c">&#34;username&#34;</span>])
</span></span><span style="display:flex;"><span>browser<span style="color:#ff79c6">.</span>find_element_by_id(<span style="color:#f1fa8c">&#34;J-password&#34;</span>)<span style="color:#ff79c6">.</span>send_keys(account[<span style="color:#f1fa8c">&#34;password&#34;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 获取全屏截图</span>
</span></span><span style="display:flex;"><span>full_img_data <span style="color:#ff79c6">=</span> browser<span style="color:#ff79c6">.</span>get_screenshot_as_png()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 截取验证图片</span>
</span></span><span style="display:flex;"><span>login_img_element <span style="color:#ff79c6">=</span> wait<span style="color:#ff79c6">.</span>until((EC<span style="color:#ff79c6">.</span>visibility_of_element_located((By<span style="color:#ff79c6">.</span>ID, <span style="color:#f1fa8c">&#34;J-loginImg&#34;</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 计算截图位置</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 截取验证码的位置</span>
</span></span><span style="display:flex;"><span>scale <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2.0</span>
</span></span><span style="display:flex;"><span>x1 <span style="color:#ff79c6">=</span> login_img_element<span style="color:#ff79c6">.</span>location[<span style="color:#f1fa8c">&#34;x&#34;</span>]
</span></span><span style="display:flex;"><span>y1 <span style="color:#ff79c6">=</span> login_img_element<span style="color:#ff79c6">.</span>location[<span style="color:#f1fa8c">&#34;y&#34;</span>]
</span></span><span style="display:flex;"><span>x2 <span style="color:#ff79c6">=</span> x1 <span style="color:#ff79c6">+</span> login_img_element<span style="color:#ff79c6">.</span>size[<span style="color:#f1fa8c">&#34;width&#34;</span>] <span style="color:#ff79c6">*</span> scale
</span></span><span style="display:flex;"><span>y2 <span style="color:#ff79c6">=</span> y1 <span style="color:#ff79c6">+</span> login_img_element<span style="color:#ff79c6">.</span>size[<span style="color:#f1fa8c">&#34;height&#34;</span>] <span style="color:#ff79c6">*</span> scale
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cut_info <span style="color:#ff79c6">=</span> (x1, y1, x2, y2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 把全屏图片构建成全屏图片操作对象</span>
</span></span><span style="display:flex;"><span>full_img <span style="color:#ff79c6">=</span> Image<span style="color:#ff79c6">.</span>open(BytesIO(full_img_data))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 通过截图信息对象截取图片</span>
</span></span><span style="display:flex;"><span>cut_img <span style="color:#ff79c6">=</span> full_img<span style="color:#ff79c6">.</span>crop(cut_info)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 把图片保存到本地</span>
</span></span><span style="display:flex;"><span>cut_img<span style="color:#ff79c6">.</span>save(<span style="color:#f1fa8c">&#39;demo.png&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 将验证图片发送到打码平台</span>
</span></span><span style="display:flex;"><span>result <span style="color:#ff79c6">=</span> decode(<span style="color:#f1fa8c">&#39;demo.png&#39;</span>, codetype<span style="color:#ff79c6">=</span><span style="color:#bd93f9">6701</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 定义八个点击坐标点</span>
</span></span><span style="display:flex;"><span>positions <span style="color:#ff79c6">=</span> [
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">7.30</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">140</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">10.58</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">140</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">13.83</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">140</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">17.11</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">140</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">7.30</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">250</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">10.58</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">250</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">13.83</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">250</span>),
</span></span><span style="display:flex;"><span>    (<span style="color:#bd93f9">17.05</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">25</span>, <span style="color:#bd93f9">250</span>)
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 模拟点击坐标</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">for</span> num <span style="color:#ff79c6">in</span> result:
</span></span><span style="display:flex;"><span>    position <span style="color:#ff79c6">=</span> positions[<span style="color:#8be9fd;font-style:italic">int</span>(num) <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 动作对象</span>
</span></span><span style="display:flex;"><span>    ActionChains(browser)<span style="color:#ff79c6">.</span>move_to_element_with_offset(login_img_element, position[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">/</span><span style="color:#bd93f9">2</span>, position[<span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">/</span><span style="color:#bd93f9">2</span>)<span style="color:#ff79c6">.</span>click()<span style="color:#ff79c6">.</span>perform()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 点击登录</span>
</span></span><span style="display:flex;"><span>browser<span style="color:#ff79c6">.</span>find_element_by_id(<span style="color:#f1fa8c">&#34;J-login&#34;</span>)<span style="color:#ff79c6">.</span>click()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 点击选择乘车人</span>
</span></span><span style="display:flex;"><span>wait<span style="color:#ff79c6">.</span>until(EC<span style="color:#ff79c6">.</span>visibility_of_element_located((By<span style="color:#ff79c6">.</span>ID, <span style="color:#f1fa8c">&#34;normalPassenger_0&#34;</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 点击提交订单</span>
</span></span><span style="display:flex;"><span>browser<span style="color:#ff79c6">.</span>find_element_by_id(<span style="color:#f1fa8c">&#34;submitOrder_id&#34;</span>)<span style="color:#ff79c6">.</span>click()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>time<span style="color:#ff79c6">.</span>sleep(<span style="color:#bd93f9">5</span>)
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/selenium/">Selenium</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">Luenci</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
