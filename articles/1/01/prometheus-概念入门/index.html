<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Prometheus 概念入门 | Luenci</title>
<meta name="keywords" content="Prometheus">
<meta name="description" content="Prometheus 概念入门
数据模型
​	Prometheus 所有采集的监控数据均以指标（metric）的形式保存在内置的时间序列数据库当中（TSDB）：属于同一指标名称，同一标签集合的、有时间戳标记的数据流。除了存储的时间序列，Prometheus 还可以根据查询请求产生临时的、衍生的时间序列作为返回结果。
指标名称和标签
每一条时间序列由指标名称（Metrics Name）以及一组标签（键值对）唯一标识。其中指标的名称（metric name）可以反映被监控样本的含义（例如，http_requests_total — 表示当前系统接收到的 HTTP 请求总量），指标名称只能由 ASCII 字符、数字、下划线以及冒号组成，同时必须匹配正则表达式 [a-zA-Z_:][a-zA-Z0-9_:]*。

[info] 注意
冒号用来表示用户自定义的记录规则，不能在 exporter 中或监控对象直接暴露的指标中使用冒号来定义指标名称。

通过使用标签，Prometheus 开启了强大的多维数据模型：对于相同的指标名称，通过不同标签列表的集合，会形成特定的度量维度实例（例如：所有包含度量名称为 /api/tracks 的 http 请求，打上 method=POST 的标签，就会形成具体的 http 请求）。该查询语言在这些指标和标签列表的基础上进行过滤和聚合。改变任何度量指标上的任何标签值（包括添加或删除指标），都会创建新的时间序列。
标签的名称只能由 ASCII 字符、数字以及下划线组成并满足正则表达式 [a-zA-Z_][a-zA-Z0-9_]*。其中以 __ 作为前缀的标签，是系统保留的关键字，只能在系统内部使用。标签的值则可以包含任何 Unicode 编码的字符。
样本
在时间序列中的每一个点称为一个样本（sample），样本由以下三部分组成：

指标（metric）：指标名称和描述当前样本特征的 labelsets；
时间戳（timestamp）：一个精确到毫秒的时间戳；
样本值（value）： 一个 folat64 的浮点型数据表示当前样本的值。
">
<meta name="author" content="Luenci">
<link rel="canonical" href="http://localhost:1313/articles/1/01/prometheus-%E6%A6%82%E5%BF%B5%E5%85%A5%E9%97%A8/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.54405a410796490bc874ab6181fac9b675753cc2b91375d8f882566459eca428.css" integrity="sha256-VEBaQQeWSQvIdKthgfrJtnV1PMK5E3XY&#43;IJWZFnspCg=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/articles/1/01/prometheus-%E6%A6%82%E5%BF%B5%E5%85%A5%E9%97%A8/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Luenci (Alt + H)">Luenci</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/index.xml" title="RSS Feed">
                    <span>RSS Feed</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Prometheus 概念入门
    </h1>
    <div class="post-meta">Luenci

</div>
  </header> 
  <div class="post-content"><h1 id="prometheus-概念入门">Prometheus 概念入门<a hidden class="anchor" aria-hidden="true" href="#prometheus-概念入门">#</a></h1>
<h1 id="数据模型">数据模型<a hidden class="anchor" aria-hidden="true" href="#数据模型">#</a></h1>
<p>​	Prometheus 所有采集的监控数据均以指标（metric）的形式保存在内置的<a href="https://www.wikiwand.com/zh/%E6%99%82%E9%96%93%E5%BA%8F%E5%88%97">时间序列</a>数据库当中（TSDB）：属于同一指标名称，同一标签集合的、有时间戳标记的数据流。除了存储的时间序列，Prometheus 还可以根据查询请求产生临时的、衍生的时间序列作为返回结果。</p>
<h2 id="指标名称和标签">指标名称和标签<a hidden class="anchor" aria-hidden="true" href="#指标名称和标签">#</a></h2>
<p>每一条时间序列由指标名称（Metrics Name）以及一组标签（键值对）唯一标识。其中指标的名称（metric name）可以反映被监控样本的含义（例如，<code>http_requests_total</code> — 表示当前系统接收到的 HTTP 请求总量），指标名称只能由 ASCII 字符、数字、下划线以及冒号组成，同时必须匹配正则表达式 <code>[a-zA-Z_:][a-zA-Z0-9_:]*</code>。</p>
<blockquote>
<p><strong>[info] 注意</strong></p>
<p>冒号用来表示用户自定义的记录规则，不能在 exporter 中或监控对象直接暴露的指标中使用冒号来定义指标名称。</p>
</blockquote>
<p>通过使用标签，Prometheus 开启了强大的多维数据模型：对于相同的指标名称，通过不同标签列表的集合，会形成特定的度量维度实例（例如：所有包含度量名称为 <code>/api/tracks</code> 的 http 请求，打上 <code>method=POST</code> 的标签，就会形成具体的 http 请求）。该查询语言在这些指标和标签列表的基础上进行过滤和聚合。改变任何度量指标上的任何标签值（包括添加或删除指标），都会创建新的时间序列。</p>
<p>标签的名称只能由 ASCII 字符、数字以及下划线组成并满足正则表达式 <code>[a-zA-Z_][a-zA-Z0-9_]*</code>。其中以 <code>__</code> 作为前缀的标签，是系统保留的关键字，只能在系统内部使用。标签的值则可以包含任何 <code>Unicode</code> 编码的字符。</p>
<h2 id="样本">样本<a hidden class="anchor" aria-hidden="true" href="#样本">#</a></h2>
<p>在时间序列中的每一个点称为一个样本（sample），样本由以下三部分组成：</p>
<ul>
<li>指标（metric）：指标名称和描述当前样本特征的 labelsets；</li>
<li>时间戳（timestamp）：一个精确到毫秒的时间戳；</li>
<li>样本值（value）： 一个 folat64 的浮点型数据表示当前样本的值。</li>
</ul>
<h2 id="表示方式">表示方式<a hidden class="anchor" aria-hidden="true" href="#表示方式">#</a></h2>
<p>通过如下表达方式表示指定指标名称和指定标签集合的时间序列：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&lt;metric name&gt;<span style="color:#ff79c6">{</span>&lt;label name&gt;<span style="color:#ff79c6">=</span>&lt;label value&gt;, ...<span style="color:#ff79c6">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>例如，指标名称为 <code>api_http_requests_total</code>，标签为 <code>method=&quot;POST&quot;</code> 和 <code>handler=&quot;/messages&quot;</code> 的时间序列可以表示为：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span>api_http_requests_total{method=&#34;POST&#34;, handler=&#34;/messages&#34;}
</span></span></code></pre></td></tr></table>
</div>
</div><p>这与 <a href="http://opentsdb.net/">OpenTSDB</a> 中使用的标记法相同。</p>
<h1 id="指标类型">指标类型<a hidden class="anchor" aria-hidden="true" href="#指标类型">#</a></h1>
<p>​	Prometheus 的客户端库中提供了四种核心的指标类型。但这些类型只是在客户端库（客户端可以根据不同的数据类型调用不同的 API 接口）和在线协议中，实际在 Prometheus server 中并不对指标类型进行区分，而是简单地把这些指标统一视为无类型的时间序列。不过，将来我们会努力改变这一现状的</p>
<h2 id="counter计数器">Counter（计数器）<a hidden class="anchor" aria-hidden="true" href="#counter计数器">#</a></h2>
<p>​	Counter 类型代表一种样本数据单调递增的指标，即只增不减，除非监控系统发生了重置。例如，你可以使用 counter 类型的指标来表示服务的请求数、已完成的任务数、错误发生的次数等。counter 主要有两个方法：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#6272a4">//将counter值加1.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#50fa7b">Inc</span>()
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// 将指定值加到counter值上，如果指定值是0会 panic.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#50fa7b">Add</span>(<span style="color:#8be9fd">float64</span>)
</span></span></code></pre></td></tr></table>
</div>
</div><p>​	Counter 类型数据可以让用户方便的了解事件产生的速率的变化，在 PromQL 内置的相关操作函数可以提供相应的分析，比如以 HTTP 应用请求量来进行说明：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-promQL" data-lang="promQL"><span style="display:flex;"><span><span style="color:#ff79c6">//</span>通过<span style="color:#ff79c6">rate</span><span style="color:#ff79c6">()</span>函数获取<span style="color:#8be9fd;font-style:italic">HTTP</span>请求量的增长率
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">rate</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">http_requests_total</span>[<span style="color:#f1fa8c">5m</span>]<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">//</span>查询当前系统中，访问量前<span style="color:#bd93f9">10</span>的<span style="color:#8be9fd;font-style:italic">HTTP</span>地址
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">weightk</span><span style="color:#ff79c6">(</span><span style="color:#bd93f9">10</span>, <span style="color:#8be9fd;font-style:italic">http_requests_total</span><span style="color:#ff79c6">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>​	不要将 counter 类型应用于样本数据非单调递增的指标，例如：当前运行的进程数量（应该用 Gauge 类型）。</p>
<h2 id="gauge仪表盘">Gauge（仪表盘）<a hidden class="anchor" aria-hidden="true" href="#gauge仪表盘">#</a></h2>
<p>​	Gauge 类型代表一种样本数据可以任意变化的指标，即可增可减。Gauge 通常用于像温度或者内存使用率这种指标数据，也可以表示能随时增加或减少的“总数”，例如：当前并发请求的数量。</p>
<p>​	对于 Gauge 类型的监控指标，通过 PromQL 内置函数 <a href="https://www.yangcs.net/prometheus/3-prometheus/functions.html#delta">delta()</a> 可以获取样本在一段时间内的变化情况，例如，计算 CPU 温度在两小时内的差异：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dalta<span style="color:#ff79c6">(</span>cpu_temp_celsius<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">host</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;zeus&#34;</span><span style="color:#ff79c6">}[</span>2h<span style="color:#ff79c6">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>​	你还可以通过PromQL 内置函数 <a href="https://www.yangcs.net/prometheus/3-prometheus/functions.html#predictlinear">predict_linear()</a> 基于简单线性回归的方式，对样本数据的变化趋势做出预测。例如，基于 2 小时的样本数据，来预测主机可用磁盘空间在 4 个小时之后的剩余情况：</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>predict_linear<span style="color:#ff79c6">(</span>node_filesystem_free<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">job</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;node&#34;</span><span style="color:#ff79c6">}[</span>2h<span style="color:#ff79c6">]</span>, <span style="color:#bd93f9">4</span> * 3600<span style="color:#ff79c6">)</span> &lt; <span style="color:#bd93f9">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="histogram直方图">Histogram（直方图）<a hidden class="anchor" aria-hidden="true" href="#histogram直方图">#</a></h2>
<p>​	在大多数情况下人们都倾向于使用某些量化指标的平均值，例如 CPU 的平均使用率、页面的平均响应时间。这种方式的问题很明显，以系统 API 调用的平均响应时间为例：如果大多数 API 请求都维持在 100ms 的响应时间范围内，而个别请求的响应时间需要 5s，那么就会导致某些 WEB 页面的响应时间落到中位数的情况，而这种现象被称为<strong>长尾问题</strong>。</p>
<p>​	为了区分是平均的慢还是长尾的慢，最简单的方式就是按照请求延迟的范围进行分组。例如，统计延迟在 0<del>10ms 之间的请求数有多少而 10</del>20ms 之间的请求数又有多少。通过这种方式可以快速分析系统慢的原因。Histogram 和 Summary 都是为了能够解决这样问题的存在，通过 Histogram 和 Summary 类型的监控指标，我们可以快速了解监控样本的分布情况。</p>
<p>​	Histogram 在一段时间范围内对数据进行采样（通常是请求持续时间或响应大小等），并将其计入可配置的存储桶（bucket）中，后续可通过指定区间筛选样本，也可以统计样本总数，最后一般将数据展示为直方图。</p>
<p>Histogram 类型的样本会提供三种指标（假设指标名称为 <code>&lt;basename&gt;</code>）：</p>
<ul>
<li>
<p>样本的值分布在 bucket 中的数量，命名为 <code>&lt;basename&gt;_bucket{le=&quot;&lt;上边界&gt;&quot;}</code>。解释的更通俗易懂一点，这个值表示指标值小于等于上边界的所有样本数量。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>  // 在总共2次请求当中。http 请求响应时间 &lt;<span style="color:#ff79c6">=</span>0.005 秒 的请求次数为0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.005&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  // 在总共2次请求当中。http 请求响应时间 &lt;<span style="color:#ff79c6">=</span>0.01 秒 的请求次数为0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.01&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  // 在总共2次请求当中。http 请求响应时间 &lt;<span style="color:#ff79c6">=</span>0.025 秒 的请求次数为0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.025&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.05&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.075&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.1&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.25&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.5&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.75&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;1.0&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;2.5&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;5.0&#34;</span>,<span style="color:#ff79c6">}</span> 0.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;7.5&#34;</span>,<span style="color:#ff79c6">}</span> 2.0
</span></span><span style="display:flex;"><span>  // 在总共2次请求当中。http 请求响应时间 &lt;<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span> 秒 的请求次数为 <span style="color:#bd93f9">2</span>
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;10.0&#34;</span>,<span style="color:#ff79c6">}</span> 2.0
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_bucket<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,le<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;+Inf&#34;</span>,<span style="color:#ff79c6">}</span> 2.0
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>所有样本值的大小总和，命名为 <code>&lt;basename&gt;_sum</code>。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>// 实际含义： 发生的2次 http 请求总的响应时间为 13.107670803000001 秒
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_sum<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#ff79c6">}</span> 13.107670803000001
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>样本总数，命名为 <code>&lt;basename&gt;_count</code>。值和 <code>&lt;basename&gt;_bucket{le=&quot;+Inf&quot;}</code> 相同。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span> // 实际含义： 当前一共发生了 <span style="color:#bd93f9">2</span> 次 http 请求
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_histogram_count<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#ff79c6">}</span> 2.0
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<blockquote>
<p><strong>[info] 注意</strong></p>
<p>bucket 可以理解为是对数据指标值域的一个划分，划分的依据应该基于数据值的分布。注意后面的采样点是包含前面的采样点的，假设 <code>xxx_bucket{...,le=&quot;0.01&quot;}</code> 的值为 10，而 <code>xxx_bucket{...,le=&quot;0.05&quot;}</code> 的值为 30，那么意味着这 30 个采样点中，有 10 个是小于 10 ms 的，其余 20 个采样点的响应时间是介于 10 ms 和 50 ms 之间的。</p>
</blockquote>
<p>​	可以通过 <a href="https://www.yangcs.net/prometheus/3-prometheus/functions.html#histogramquantile">histogram_quantile() 函数</a>来计算 Histogram 类型样本的<a href="https://www.wikiwand.com/zh-hans/%E5%88%86%E4%BD%8D%E6%95%B0">分位数</a>。分位数可能不太好理解，你可以理解为分割数据的点。我举个例子，假设样本的 9 分位数（quantile=0.9）的值为 x，即表示小于 x 的采样值的数量占总体采样值的 90%。Histogram 还可以用来计算应用性能指标值（<a href="https://www.wikiwand.com/en/Apdex">Apdex score</a>）。</p>
<h2 id="summary摘要">Summary（摘要）<a hidden class="anchor" aria-hidden="true" href="#summary摘要">#</a></h2>
<p>​	与 Histogram 类型类似，用于表示一段时间内的数据采样结果（通常是请求持续时间或响应大小等），但它直接存储了分位数（通过客户端计算，然后展示出来），而不是通过区间来计算。</p>
<p>​	Summary 类型的样本也会提供三种指标（假设指标名称为 ）：</p>
<ul>
<li>
<p>样本值的分位数分布情况，命名为 <code>&lt;basename&gt;{quantile=&quot;&lt;φ&gt;&quot;}</code>。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>// 含义：这 <span style="color:#bd93f9">12</span> 次 http 请求中有 50% 的请求响应时间是 3.052404983s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io_namespace_http_requests_latency_seconds_summary<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,quantile<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.5&#34;</span>,<span style="color:#ff79c6">}</span> 3.052404983
</span></span><span style="display:flex;"><span>  // 含义：这 <span style="color:#bd93f9">12</span> 次 http 请求中有 90% 的请求响应时间是 8.003261666s
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_summary<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,quantile<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;0.9&#34;</span>,<span style="color:#ff79c6">}</span> 8.003261666
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>所有样本值的大小总和，命名为 <code>&lt;basename&gt;_sum</code>。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>// 含义：这12次 http 请求的总响应时间为 51.029495508s
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_summary_sum<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#ff79c6">}</span> 51.029495508
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>样本总数，命名为 <code>&lt;basename&gt;_count</code>。</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>// 含义：当前一共发生了 <span style="color:#bd93f9">12</span> 次 http 请求
</span></span><span style="display:flex;"><span>  io_namespace_http_requests_latency_seconds_summary_count<span style="color:#ff79c6">{</span><span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/&#34;</span>,method<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>,code<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#ff79c6">}</span> 12.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>现在可以总结一下 Histogram 与 Summary 的异同：</p>
<ul>
<li>
<p>它们都包含了 <code>&lt;basename&gt;_sum</code> 和 <code>&lt;basename&gt;_count</code> 指标</p>
</li>
<li>
<p>Histogram 需要通过 <code>&lt;basename&gt;_bucket</code> 来计算分位数，而 Summary 则直接存储了分位数的值。</p>
</li>
</ul>
<p>关于 Summary 与 Histogram 的详细用法，请参考 <a href="https://prometheus.io/docs/practices/histograms">histograms and summaries</a>。</p>
</li>
</ul>
<h1 id="参考文章">参考文章<a hidden class="anchor" aria-hidden="true" href="#参考文章">#</a></h1>
<p><a href="https://prometheus.fuckcloudnative.io/di-er-zhang-gai-nian/data_model">第1节：数据模型 - Prometheus 中文文档 (fuckcloudnative.io)</a></p>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/prometheus/">Prometheus</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">Luenci</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
