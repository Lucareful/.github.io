<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>python的进程概念 | Luenci</title>
<meta name="keywords" content="进程概念">
<meta name="description" content="进程
进程概念


进程（Process）是资源分配的最小单位，是线程的容器。


程序是固定不变的，而进程会根据运行需要，让操作系统动态分配各种资源的CPU的时间片轮转，在不同的时间段切换执行不同的进程，但是切换进程是比较耗时的；就引来了轻量级进程，也就是所谓的线程，一个进程中包括多个线程（代码流，其实也就是进程中同时跑的多个方法体）


程序：例xxx.py这是程序，是一个静态的


进程：一个程序运行起来后，代码&#43;用到的资源称之为进程，它是操作系统分配资源的基本单元。


进程状态


工作中，任务数往往大于cpu的核数，即一定有一些任务正在执行，而另外一些任务在等待cpu进行执行，因此导致了有了不同的状态


进程状态

就绪态：运行的条件都已经满足，正在等在cpu执行
执行态：cpu正在执行其功能
等待态：等待某些条件满足，例如一个程序sleep了，此时就处于等待态



进程的创建 - multiprocessing


multiprocessing模块就是跨平台版本的多进程模块，提供了一个Process类来代表一个进程对象，这个对象可以理解为是一个独立的进程，可以执行另外的事情。


·创建子进程跟创建线程十分类似，只需要传入一个执行函数和函数的参数，创建一个Process实例，用start0方法后动


Process语法结构如下：
Process([group [，target[，name，[args[，kwargs]]]）

target：如果传递了函数的引用，这个子进程就执行这里（函数）的代码
args：给target指定的函数传递的参数，以元组的方式传递
kwargs：给target指定的函数传递命名参数
name：给进程设定一个名字，可以不设定
group：指定进程组，大多数情况下用不到



Process创建的实例对象的常用方法：

start()：后动子进程实例（创建子进程）
is_alive：判断进程子进程是否还在活着
join([timeout]）：是否等待子进程执行结束，或等待多少秒o
terminate：不管任务是否完成，立即终止子进程



Process创建的实例对象的常用属性：

name：当前进程的别名，默认为Process-N，N为从1开始递增的整数
pid：当前进程的pid（进程号）



linux系统可使用kill命令结束进程

">
<meta name="author" content="Luenci">
<link rel="canonical" href="https://Lucareful.github.io/en/posts/%E5%A4%9A%E8%BF%9B%E7%A8%8B/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://Lucareful.github.io/images/L.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://Lucareful.github.io/images/L.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://Lucareful.github.io/images/L.png">
<link rel="apple-touch-icon" href="https://Lucareful.github.io/L.png">
<link rel="mask-icon" href="https://Lucareful.github.io/L.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://Lucareful.github.io/en/posts/%E5%A4%9A%E8%BF%9B%E7%A8%8B/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="python的进程概念" />
<meta property="og:description" content="进程
进程概念


进程（Process）是资源分配的最小单位，是线程的容器。


程序是固定不变的，而进程会根据运行需要，让操作系统动态分配各种资源的CPU的时间片轮转，在不同的时间段切换执行不同的进程，但是切换进程是比较耗时的；就引来了轻量级进程，也就是所谓的线程，一个进程中包括多个线程（代码流，其实也就是进程中同时跑的多个方法体）


程序：例xxx.py这是程序，是一个静态的


进程：一个程序运行起来后，代码&#43;用到的资源称之为进程，它是操作系统分配资源的基本单元。


进程状态


工作中，任务数往往大于cpu的核数，即一定有一些任务正在执行，而另外一些任务在等待cpu进行执行，因此导致了有了不同的状态


进程状态

就绪态：运行的条件都已经满足，正在等在cpu执行
执行态：cpu正在执行其功能
等待态：等待某些条件满足，例如一个程序sleep了，此时就处于等待态



进程的创建 - multiprocessing


multiprocessing模块就是跨平台版本的多进程模块，提供了一个Process类来代表一个进程对象，这个对象可以理解为是一个独立的进程，可以执行另外的事情。


·创建子进程跟创建线程十分类似，只需要传入一个执行函数和函数的参数，创建一个Process实例，用start0方法后动


Process语法结构如下：
Process([group [，target[，name，[args[，kwargs]]]）

target：如果传递了函数的引用，这个子进程就执行这里（函数）的代码
args：给target指定的函数传递的参数，以元组的方式传递
kwargs：给target指定的函数传递命名参数
name：给进程设定一个名字，可以不设定
group：指定进程组，大多数情况下用不到



Process创建的实例对象的常用方法：

start()：后动子进程实例（创建子进程）
is_alive：判断进程子进程是否还在活着
join([timeout]）：是否等待子进程执行结束，或等待多少秒o
terminate：不管任务是否完成，立即终止子进程



Process创建的实例对象的常用属性：

name：当前进程的别名，默认为Process-N，N为从1开始递增的整数
pid：当前进程的pid（进程号）



linux系统可使用kill命令结束进程

" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Lucareful.github.io/en/posts/%E5%A4%9A%E8%BF%9B%E7%A8%8B/" /><meta property="article:section" content="posts" />

<meta property="og:site_name" content="(〃&#39;▽&#39;〃)" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="python的进程概念"/>
<meta name="twitter:description" content="进程
进程概念


进程（Process）是资源分配的最小单位，是线程的容器。


程序是固定不变的，而进程会根据运行需要，让操作系统动态分配各种资源的CPU的时间片轮转，在不同的时间段切换执行不同的进程，但是切换进程是比较耗时的；就引来了轻量级进程，也就是所谓的线程，一个进程中包括多个线程（代码流，其实也就是进程中同时跑的多个方法体）


程序：例xxx.py这是程序，是一个静态的


进程：一个程序运行起来后，代码&#43;用到的资源称之为进程，它是操作系统分配资源的基本单元。


进程状态


工作中，任务数往往大于cpu的核数，即一定有一些任务正在执行，而另外一些任务在等待cpu进行执行，因此导致了有了不同的状态


进程状态

就绪态：运行的条件都已经满足，正在等在cpu执行
执行态：cpu正在执行其功能
等待态：等待某些条件满足，例如一个程序sleep了，此时就处于等待态



进程的创建 - multiprocessing


multiprocessing模块就是跨平台版本的多进程模块，提供了一个Process类来代表一个进程对象，这个对象可以理解为是一个独立的进程，可以执行另外的事情。


·创建子进程跟创建线程十分类似，只需要传入一个执行函数和函数的参数，创建一个Process实例，用start0方法后动


Process语法结构如下：
Process([group [，target[，name，[args[，kwargs]]]）

target：如果传递了函数的引用，这个子进程就执行这里（函数）的代码
args：给target指定的函数传递的参数，以元组的方式传递
kwargs：给target指定的函数传递命名参数
name：给进程设定一个名字，可以不设定
group：指定进程组，大多数情况下用不到



Process创建的实例对象的常用方法：

start()：后动子进程实例（创建子进程）
is_alive：判断进程子进程是否还在活着
join([timeout]）：是否等待子进程执行结束，或等待多少秒o
terminate：不管任务是否完成，立即终止子进程



Process创建的实例对象的常用属性：

name：当前进程的别名，默认为Process-N，N为从1开始递增的整数
pid：当前进程的pid（进程号）



linux系统可使用kill命令结束进程

"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://Lucareful.github.io/en/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "python的进程概念",
      "item": "https://Lucareful.github.io/en/posts/%E5%A4%9A%E8%BF%9B%E7%A8%8B/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "python的进程概念",
  "name": "python的进程概念",
  "description": "进程 进程概念 进程（Process）是资源分配的最小单位，是线程的容器。\n程序是固定不变的，而进程会根据运行需要，让操作系统动态分配各种资源的CPU的时间片轮转，在不同的时间段切换执行不同的进程，但是切换进程是比较耗时的；就引来了轻量级进程，也就是所谓的线程，一个进程中包括多个线程（代码流，其实也就是进程中同时跑的多个方法体）\n程序：例xxx.py这是程序，是一个静态的\n进程：一个程序运行起来后，代码+用到的资源称之为进程，它是操作系统分配资源的基本单元。\n进程状态 工作中，任务数往往大于cpu的核数，即一定有一些任务正在执行，而另外一些任务在等待cpu进行执行，因此导致了有了不同的状态\n进程状态\n就绪态：运行的条件都已经满足，正在等在cpu执行 执行态：cpu正在执行其功能 等待态：等待某些条件满足，例如一个程序sleep了，此时就处于等待态 进程的创建 - multiprocessing multiprocessing模块就是跨平台版本的多进程模块，提供了一个Process类来代表一个进程对象，这个对象可以理解为是一个独立的进程，可以执行另外的事情。\n·创建子进程跟创建线程十分类似，只需要传入一个执行函数和函数的参数，创建一个Process实例，用start0方法后动\nProcess语法结构如下： Process([group [，target[，name，[args[，kwargs]]]）\ntarget：如果传递了函数的引用，这个子进程就执行这里（函数）的代码 args：给target指定的函数传递的参数，以元组的方式传递 kwargs：给target指定的函数传递命名参数 name：给进程设定一个名字，可以不设定 group：指定进程组，大多数情况下用不到 Process创建的实例对象的常用方法：\nstart()：后动子进程实例（创建子进程） is_alive：判断进程子进程是否还在活着 join([timeout]）：是否等待子进程执行结束，或等待多少秒o terminate：不管任务是否完成，立即终止子进程 Process创建的实例对象的常用属性：\nname：当前进程的别名，默认为Process-N，N为从1开始递增的整数 pid：当前进程的pid（进程号） linux系统可使用kill命令结束进程\n",
  "keywords": [
    "进程概念"
  ],
  "articleBody": "进程 进程概念 进程（Process）是资源分配的最小单位，是线程的容器。\n程序是固定不变的，而进程会根据运行需要，让操作系统动态分配各种资源的CPU的时间片轮转，在不同的时间段切换执行不同的进程，但是切换进程是比较耗时的；就引来了轻量级进程，也就是所谓的线程，一个进程中包括多个线程（代码流，其实也就是进程中同时跑的多个方法体）\n程序：例xxx.py这是程序，是一个静态的\n进程：一个程序运行起来后，代码+用到的资源称之为进程，它是操作系统分配资源的基本单元。\n进程状态 工作中，任务数往往大于cpu的核数，即一定有一些任务正在执行，而另外一些任务在等待cpu进行执行，因此导致了有了不同的状态\n进程状态\n就绪态：运行的条件都已经满足，正在等在cpu执行 执行态：cpu正在执行其功能 等待态：等待某些条件满足，例如一个程序sleep了，此时就处于等待态 进程的创建 - multiprocessing multiprocessing模块就是跨平台版本的多进程模块，提供了一个Process类来代表一个进程对象，这个对象可以理解为是一个独立的进程，可以执行另外的事情。\n·创建子进程跟创建线程十分类似，只需要传入一个执行函数和函数的参数，创建一个Process实例，用start0方法后动\nProcess语法结构如下： Process([group [，target[，name，[args[，kwargs]]]）\ntarget：如果传递了函数的引用，这个子进程就执行这里（函数）的代码 args：给target指定的函数传递的参数，以元组的方式传递 kwargs：给target指定的函数传递命名参数 name：给进程设定一个名字，可以不设定 group：指定进程组，大多数情况下用不到 Process创建的实例对象的常用方法：\nstart()：后动子进程实例（创建子进程） is_alive：判断进程子进程是否还在活着 join([timeout]）：是否等待子进程执行结束，或等待多少秒o terminate：不管任务是否完成，立即终止子进程 Process创建的实例对象的常用属性：\nname：当前进程的别名，默认为Process-N，N为从1开始递增的整数 pid：当前进程的pid（进程号） linux系统可使用kill命令结束进程\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 import multiprocessing import os import time def work1(): for i in range(10): # 获取进程的父id print(\"正在运行work1 第{}次..进程id{}，父进程id{}\".format(i, os.getpid(), os.getppid())) time.sleep(2) if __name__ == '__main__': # 获取主进程名称 print(\"主进程名称\", multiprocessing.current_process()) # 获取进程的编号 # 1.获取进程id multiprocessing.current_process().pid print(\"主进程编号\", multiprocessing.current_process().pid) # 2. 模块os # print(os.getpid()) process_obj = multiprocessing.Process(target=work1, name=\"进程一\") process_obj.start() print(\"XXXX\") out: 主进程名称 \u003c_MainProcess(MainProcess, started)\u003e 主进程编号 31776 XXXX 正在运行work1 第0次..进程id43088，父进程id31776 正在运行work1 第1次..进程id43088，父进程id31776 正在运行work1 第2次..进程id43088，父进程id31776 正在运行work1 第3次..进程id43088，父进程id31776 正在运行work1 第4次..进程id43088，父进程id31776 正在运行work1 第5次..进程id43088，父进程id31776 正在运行work1 第6次..进程id43088，父进程id31776 正在运行work1 第7次..进程id43088，父进程id31776 正在运行work1 第8次..进程id43088，父进程id31776 正在运行work1 第9次..进程id43088，父进程id31776 进程参数，全局变量 进程间不能共享全局变量 子进程在运行时候，会将主进程的内容复制到自己进程中，修改只限自己进程有效。不影响其他进程和主进程 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 import multiprocessing # 定义全局变量 import time g_num = 10 def work1(): global g_num for i in range(10): g_num += 1 print(\"work1---------\", g_num) def work2(): print(\"work1---------\", g_num) if __name__ == '__main__': p1 = multiprocessing.Process(target=work1) p2 = multiprocessing.Process(target=work2) p1.start() p2.start() time.sleep(3) print(\"---------main-----------\", g_num) out: work1--------- 20 work1--------- 10 ---------main----------- 10 守护进程 p1.daemon=True设置子进程p1守护主进程，当主进程结束的时候，子进程也随之结束 p1.terminate（）终止进程执行，并非是守护进程 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 import multiprocessing import time def work1(): for i in range(10): print(\"正在运行work1...{}\".format(time.ctime())) time.sleep(0.5) if __name__ == '__main__': process_obj = multiprocessing.Process(target=work1) # 开启守护 # process_obj.daemon = True process_obj.start() print(\"我睡两秒就结束\", time.ctime()) time.sleep(2) # 终止进程 process_obj.terminate() exit() out: 我睡两秒就结束 Thu Nov 14 16:04:29 2019 正在运行work1...Thu Nov 14 16:04:29 2019 正在运行work1...Thu Nov 14 16:04:30 2019 正在运行work1...Thu Nov 14 16:04:30 2019 正在运行work1...Thu Nov 14 16:04:31 2019 进程线程对比 功能 进程，能够完成多任务，比如在一台电脑上能够同时运行多个QQ 线程，能够完成多任务，比如一个QQ中的多个聊天窗口 使用区别 进程是系统进行资源分配和调度的一个独立单位。 线程是进程的一介实体，是CPU调度和分派的基本单位，它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源（如程序计数器，一组寄存器和栈），但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源. 一个程序至少有一个进程，一个进程至少有一个线程. 线程的划分尺度小于进程（资源比进程少），使得多线程程序的并发性高。 进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率 线程不能独立运行，必须依赖于线程 对比维度 多进程 多线程 总结 数据共享，同步 数据共享复杂，需要用IPC；数据是分开因为共享进程数据，数据共享简单 因为共享进程数据，数据共享简单，但也是因为这个原因导致同步复杂 各有千秋 内存、CPU 占用内存多，切换复杂，CPU利用率低 占用内存少，切换简单，PU利用率高CPU 线程占优 创建销毁、切换 创建销毁、切换复杂，速度慢 创建销毁、切换简单，速度很快 线程占优 编程，调试 编程简单，调试简单 编程复杂，调试复杂 进程占优 可靠性 进程间不会互相影响 一个线程挂掉将导致整个进程挂掉 进程占优 分布式 适应于多核、多机分布式；如果一台机器不够，扩展到多台机器比较简单 应用于多核分布式 进程占优 进程线程取舍 需要频繁创建销毁的先使用线程；（如：Web服务器） 线程的切换速度快，所以在需要大量计算，切换频繁时用线程（如图像处理、算法处理） 因为对CPU系统的效率使用上线程更占优，所以可能要发展到多机分布的用进程，多核分布用线程； 需要更稳定安全时，适合选择进程；需要速度时，选择线程更好。 都满足需求的情况下，用你最熟悉、最拿手的方式 需要提醒的是：虽然有这么多的选择原则，但实际应用中基本上都是“进程+线程”的结合方式 在Python的原始解释器CPython中存在着GlL（Global Interpreter Lock，全局解释器锁），因此在解释执行python代码时，会产生互斥锁来限制线程对共享资源的访问，直到解释器遇到I/O操作或者操作次数达到一定数目时才会释放GlL。造成了即使在多核CPU中，多线程也只是做着分时切换而已 消息队列 可以使用multiprocessing模块的Queue实现多进程之间的数据传递 Queue本身是一个消息列队程序 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 import multiprocessing # 创建队列(指定长度) queue = multiprocessing.Queue(5) # 向队列中放值 queue.put(\"Luenci\") queue.put(1) queue.put([5, 2]) queue.put((9, 8, 7)) queue.put({\"a\": 6, \"b\": 8}) # 判断队列是否全满 isfull = queue.full() print(\"队列为全满：\", isfull) # 长度为5，放入第6个数据后，队列就进行入了阻塞状态，默认会等待以列先取出值再放入新的值 # queue.put(22) # 不等待的放入 # queue.put_nowait(11) # 向队列中取值 # 当队列为空的时候，再取值的时候，程序会进行阻塞状态，等待队列中有值再取 value = queue.get() print(value) # 当队列为空的时候，再取值的时候，程序会直接报错 # value = queue.get_nowait() # 队列元素个数 num = queue.qsize() print(num) # 判断队列是否为空 empty = queue.empty() print(\"队列为空？：\", empty) 进程池 进程池概述 当需要创建的子进程数量不多时，可以直接利用multiprocessing中的Process动态成生多个进程，但如果是上百甚至上千个目标，手动的去创建进程的工作量巨大，此时就可以用到multiprocessing模块提供的Pool方法。 初始化Pool时，可以指定一个最大进程数，当有新的请求提交到Pool中时，如果池还没有满，那么就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到指定的最大值，那么该请求就会等待，直到池中有进程结束，才会用之前的进程来执行新的任务。 进程池实现方式 同步方式：pool.apply() 异步方式pool.apply_async（copy_work） 核心方法 multiprocessing.Pool常用函数解析： apply（）：–进程池中进程以同步方式执行任务 apply_async（func[，args[，kwds]]）：–使用非阻塞方式调用func（并行执行，堵塞方式必须等待上一个进程退出才能执行下一个进程），args为传递给func的参数列表，kwds为传递给func的关键字参数列表 进程池中的进程通信 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 import multiprocessing import time def write_queue(queue): for i in range(10): if queue.full(): print(\"队列已满\") break else: queue.put(i) print(\"成功添加：\", i) time.sleep(0.5) def read_queue(queue): while True: if queue.qsize() == 0: print(\"队列已空\") break value = queue.get() print(\"已经读取\", value) if __name__ == '__main__': # 创建进程池 pool = multiprocessing.Pool(3) # 创建进程池中的队列 queue = multiprocessing.Manager().Queue(10) # 同步的方式执行 # pool.apply(write_queue, args=(queue,)) # pool.apply(read_queue, args=(queue,)) # 异步的方式执行 # apply_async（）返回值ApplyResult对象，该对象有一个wait（）的方法 result = pool.apply_async(write_queue, args=(queue,)) result.wait() pool.apply_async(read_queue, args=(queue,)) # 不再接收新的任务 pool.close() pool.join() out: 成功添加： 0 成功添加： 1 成功添加： 2 成功添加： 3 成功添加： 4 成功添加： 5 成功添加： 6 成功添加： 7 成功添加： 8 成功添加： 9 已经读取 0 已经读取 1 已经读取 2 已经读取 3 已经读取 4 已经读取 5 已经读取 6 已经读取 7 已经读取 8 已经读取 9 队列已空 ",
  "wordCount" : "4160",
  "inLanguage": "en",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Luenci"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://Lucareful.github.io/en/posts/%E5%A4%9A%E8%BF%9B%E7%A8%8B/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Luenci",
    "logo": {
      "@type": "ImageObject",
      "url": "https://Lucareful.github.io/images/L.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://Lucareful.github.io/en/" accesskey="h" title="Luenci (Alt + H)">
                <img src="https://Lucareful.github.io/images/avatar.jpg" alt="" aria-label="logo"
                    height="35">Luenci</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://Lucareful.github.io/en/" title="🏠主页">
                    <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://Lucareful.github.io/en/posts" title="📚文章">
                    <span>📚文章</span>
                </a>
            </li>
            <li>
                <a href="https://Lucareful.github.io/en/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                    <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://Lucareful.github.io/en/archives" title="⏱时间轴">
                    <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://Lucareful.github.io/en/tags" title="🔖标签">
                    <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://Lucareful.github.io/en/about" title="🙋🏻‍♂️关于">
                    <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
            <li>
                <a href="https://Lucareful.github.io/en/links" title="🤝友链">
                    <span>🤝友链</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://Lucareful.github.io/en/">Home</a>&nbsp;»&nbsp;<a href="https://Lucareful.github.io/en/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      python的进程概念
    </h1>
    <div class="post-meta">9 min&nbsp;·&nbsp;4160 words&nbsp;·&nbsp;Luenci

</div>
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">目录</span>
            </summary>

        <div class="inner"><ul>
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b" aria-label="进程">进程</a><ul>
                            
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b%e6%a6%82%e5%bf%b5" aria-label="进程概念">进程概念</a></li>
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b%e7%8a%b6%e6%80%81" aria-label="进程状态">进程状态</a></li>
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b%e7%9a%84%e5%88%9b%e5%bb%ba---multiprocessing" aria-label="进程的创建 - multiprocessing">进程的创建 - multiprocessing</a></li>
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b%e5%8f%82%e6%95%b0%e5%85%a8%e5%b1%80%e5%8f%98%e9%87%8f" aria-label="进程参数，全局变量">进程参数，全局变量</a></li>
                    <li>
                        <a href="#%e5%ae%88%e6%8a%a4%e8%bf%9b%e7%a8%8b" aria-label="守护进程">守护进程</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b%e7%ba%bf%e7%a8%8b%e5%af%b9%e6%af%94" aria-label="进程线程对比">进程线程对比</a><ul>
                            
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b%e7%ba%bf%e7%a8%8b%e5%8f%96%e8%88%8d" aria-label="进程线程取舍">进程线程取舍</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e6%b6%88%e6%81%af%e9%98%9f%e5%88%97" aria-label="消息队列">消息队列</a></li>
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b%e6%b1%a0" aria-label="进程池">进程池</a><ul>
                            
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b%e6%b1%a0%e5%ae%9e%e7%8e%b0%e6%96%b9%e5%bc%8f" aria-label="进程池实现方式">进程池实现方式</a></li>
                    <li>
                        <a href="#%e6%a0%b8%e5%bf%83%e6%96%b9%e6%b3%95" aria-label="核心方法">核心方法</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e8%bf%9b%e7%a8%8b%e6%b1%a0%e4%b8%ad%e7%9a%84%e8%bf%9b%e7%a8%8b%e9%80%9a%e4%bf%a1" aria-label="进程池中的进程通信">进程池中的进程通信</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>
  <div class="post-content"><h1 id="进程">进程<a hidden class="anchor" aria-hidden="true" href="#进程">#</a></h1>
<h2 id="进程概念">进程概念<a hidden class="anchor" aria-hidden="true" href="#进程概念">#</a></h2>
<ul>
<li>
<p>进程（Process）是资源分配的最小单位，是线程的容器。</p>
</li>
<li>
<p>程序是固定不变的，而进程会根据运行需要，让操作系统动态分配各种资源的CPU的时间片轮转，在不同的时间段切换执行不同的进程，但是切换进程是比较耗时的；就引来了轻量级进程，也就是所谓的线程，一个进程中包括多个线程（代码流，其实也就是进程中同时跑的多个方法体）</p>
</li>
<li>
<p>程序：例<code>xxx.py</code>这是程序，是一个静态的</p>
</li>
<li>
<p>进程：一个程序运行起来后，代码+用到的资源称之为进程，它是操作系统分配资源的基本单元。</p>
</li>
</ul>
<h2 id="进程状态">进程状态<a hidden class="anchor" aria-hidden="true" href="#进程状态">#</a></h2>
<ul>
<li>
<p>工作中，任务数往往大于cpu的核数，即一定有一些任务正在执行，而另外一些任务在等待cpu进行执行，因此导致了有了不同的状态</p>
</li>
<li>
<p>进程状态</p>
<ul>
<li>就绪态：运行的条件都已经满足，正在等在cpu执行</li>
<li>执行态：cpu正在执行其功能</li>
<li>等待态：等待某些条件满足，例如一个程序sleep了，此时就处于等待态</li>
</ul>
</li>
</ul>
<h2 id="进程的创建---multiprocessing">进程的创建 - multiprocessing<a hidden class="anchor" aria-hidden="true" href="#进程的创建---multiprocessing">#</a></h2>
<ul>
<li>
<p>multiprocessing模块就是跨平台版本的多进程模块，提供了一个Process类来代表一个进程对象，这个对象可以理解为是一个独立的进程，可以执行另外的事情。</p>
</li>
<li>
<p>·创建子进程跟创建线程十分类似，只需要传入一个执行函数和函数的参数，创建一个Process实例，用start0方法后动</p>
</li>
<li>
<p>Process语法结构如下：
<code>Process([group [，target[，name，[args[，kwargs]]]）</code></p>
<ul>
<li>target：如果传递了函数的引用，这个子进程就执行这里（函数）的代码</li>
<li>args：给target指定的函数传递的参数，以元组的方式传递</li>
<li>kwargs：给target指定的函数传递命名参数</li>
<li>name：给进程设定一个名字，可以不设定</li>
<li>group：指定进程组，大多数情况下用不到</li>
</ul>
</li>
<li>
<p>Process创建的实例对象的常用方法：</p>
<ul>
<li>start()：后动子进程实例（创建子进程）</li>
<li>is_alive：判断进程子进程是否还在活着</li>
<li>join([timeout]）：是否等待子进程执行结束，或等待多少秒o</li>
<li>terminate：不管任务是否完成，立即终止子进程</li>
</ul>
</li>
<li>
<p>Process创建的实例对象的常用属性：</p>
<ul>
<li>name：当前进程的别名，默认为Process-N，N为从1开始递增的整数</li>
<li>pid：当前进程的pid（进程号）</li>
</ul>
</li>
<li>
<p><code>linux</code>系统可使用<code>kill</code>命令结束进程</p>
</li>
</ul>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">multiprocessing</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">os</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">work1</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">for</span> i <span style="color:#ff7b72;font-weight:bold">in</span> range(<span style="color:#a5d6ff">10</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic"># 获取进程的父id</span>
</span></span><span style="display:flex;"><span>        print(<span style="color:#a5d6ff">&#34;正在运行work1  第</span><span style="color:#a5d6ff">{}</span><span style="color:#a5d6ff">次..进程id</span><span style="color:#a5d6ff">{}</span><span style="color:#a5d6ff">，父进程id</span><span style="color:#a5d6ff">{}</span><span style="color:#a5d6ff">&#34;</span><span style="color:#ff7b72;font-weight:bold">.</span>format(i, os<span style="color:#ff7b72;font-weight:bold">.</span>getpid(), os<span style="color:#ff7b72;font-weight:bold">.</span>getppid()))
</span></span><span style="display:flex;"><span>        time<span style="color:#ff7b72;font-weight:bold">.</span>sleep(<span style="color:#a5d6ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">if</span> __name__ <span style="color:#ff7b72;font-weight:bold">==</span> <span style="color:#a5d6ff">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 获取主进程名称</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#a5d6ff">&#34;主进程名称&#34;</span>, multiprocessing<span style="color:#ff7b72;font-weight:bold">.</span>current_process())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 获取进程的编号</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 1.获取进程id multiprocessing.current_process().pid</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#a5d6ff">&#34;主进程编号&#34;</span>, multiprocessing<span style="color:#ff7b72;font-weight:bold">.</span>current_process()<span style="color:#ff7b72;font-weight:bold">.</span>pid)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 2. 模块os</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># print(os.getpid())</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    process_obj <span style="color:#ff7b72;font-weight:bold">=</span> multiprocessing<span style="color:#ff7b72;font-weight:bold">.</span>Process(target<span style="color:#ff7b72;font-weight:bold">=</span>work1, name<span style="color:#ff7b72;font-weight:bold">=</span><span style="color:#a5d6ff">&#34;进程一&#34;</span>)
</span></span><span style="display:flex;"><span>    process_obj<span style="color:#ff7b72;font-weight:bold">.</span>start()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#a5d6ff">&#34;XXXX&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>out:
</span></span><span style="display:flex;"><span>    主进程名称 <span style="color:#ff7b72;font-weight:bold">&lt;</span>_MainProcess(MainProcess, started)<span style="color:#ff7b72;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    主进程编号 <span style="color:#a5d6ff">31776</span>
</span></span><span style="display:flex;"><span>    XXXX
</span></span><span style="display:flex;"><span>    正在运行work1  第0次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span><span style="display:flex;"><span>    正在运行work1  第1次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span><span style="display:flex;"><span>    正在运行work1  第2次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span><span style="display:flex;"><span>    正在运行work1  第3次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span><span style="display:flex;"><span>    正在运行work1  第4次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span><span style="display:flex;"><span>    正在运行work1  第5次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span><span style="display:flex;"><span>    正在运行work1  第6次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span><span style="display:flex;"><span>    正在运行work1  第7次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span><span style="display:flex;"><span>    正在运行work1  第8次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span><span style="display:flex;"><span>    正在运行work1  第9次<span style="color:#ff7b72;font-weight:bold">..</span>进程id43088<span style="color:#f85149">，</span>父进程id31776
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="进程参数全局变量">进程参数，全局变量<a hidden class="anchor" aria-hidden="true" href="#进程参数全局变量">#</a></h2>
<ul>
<li>进程间不能共享全局变量</li>
<li>子进程在运行时候，会将主进程的内容<code>复制</code>到自己进程中，修改只限自己进程有效。不影响其他进程和主进程</li>
</ul>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">multiprocessing</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 定义全局变量</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>g_num <span style="color:#ff7b72;font-weight:bold">=</span> <span style="color:#a5d6ff">10</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">work1</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">global</span> g_num
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">for</span> i <span style="color:#ff7b72;font-weight:bold">in</span> range(<span style="color:#a5d6ff">10</span>):
</span></span><span style="display:flex;"><span>        g_num <span style="color:#ff7b72;font-weight:bold">+=</span> <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#a5d6ff">&#34;work1---------&#34;</span>, g_num)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">work2</span>():
</span></span><span style="display:flex;"><span>    print(<span style="color:#a5d6ff">&#34;work1---------&#34;</span>, g_num)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">if</span> __name__ <span style="color:#ff7b72;font-weight:bold">==</span> <span style="color:#a5d6ff">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    p1 <span style="color:#ff7b72;font-weight:bold">=</span> multiprocessing<span style="color:#ff7b72;font-weight:bold">.</span>Process(target<span style="color:#ff7b72;font-weight:bold">=</span>work1)
</span></span><span style="display:flex;"><span>    p2 <span style="color:#ff7b72;font-weight:bold">=</span> multiprocessing<span style="color:#ff7b72;font-weight:bold">.</span>Process(target<span style="color:#ff7b72;font-weight:bold">=</span>work2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    p1<span style="color:#ff7b72;font-weight:bold">.</span>start()
</span></span><span style="display:flex;"><span>    p2<span style="color:#ff7b72;font-weight:bold">.</span>start()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    time<span style="color:#ff7b72;font-weight:bold">.</span>sleep(<span style="color:#a5d6ff">3</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#a5d6ff">&#34;---------main-----------&#34;</span>, g_num)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>out:
</span></span><span style="display:flex;"><span>    work1<span style="color:#ff7b72;font-weight:bold">---------</span> <span style="color:#a5d6ff">20</span>
</span></span><span style="display:flex;"><span>    work1<span style="color:#ff7b72;font-weight:bold">---------</span> <span style="color:#a5d6ff">10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72;font-weight:bold">---------</span>main<span style="color:#ff7b72;font-weight:bold">-----------</span> <span style="color:#a5d6ff">10</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="守护进程">守护进程<a hidden class="anchor" aria-hidden="true" href="#守护进程">#</a></h2>
<ul>
<li><code>p1.daemon=True</code>设置子进程<code>p1</code>守护主进程，当主进程结束的时候，子进程也随之结束</li>
<li><code>p1.terminate（）</code>终止进程执行，并非是守护进程</li>
</ul>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">multiprocessing</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">work1</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">for</span> i <span style="color:#ff7b72;font-weight:bold">in</span> range(<span style="color:#a5d6ff">10</span>):
</span></span><span style="display:flex;"><span>        print(<span style="color:#a5d6ff">&#34;正在运行work1...</span><span style="color:#a5d6ff">{}</span><span style="color:#a5d6ff">&#34;</span><span style="color:#ff7b72;font-weight:bold">.</span>format(time<span style="color:#ff7b72;font-weight:bold">.</span>ctime()))
</span></span><span style="display:flex;"><span>        time<span style="color:#ff7b72;font-weight:bold">.</span>sleep(<span style="color:#a5d6ff">0.5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">if</span> __name__ <span style="color:#ff7b72;font-weight:bold">==</span> <span style="color:#a5d6ff">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    process_obj <span style="color:#ff7b72;font-weight:bold">=</span> multiprocessing<span style="color:#ff7b72;font-weight:bold">.</span>Process(target<span style="color:#ff7b72;font-weight:bold">=</span>work1)
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 开启守护</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># process_obj.daemon = True</span>
</span></span><span style="display:flex;"><span>    process_obj<span style="color:#ff7b72;font-weight:bold">.</span>start()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#a5d6ff">&#34;我睡两秒就结束&#34;</span>, time<span style="color:#ff7b72;font-weight:bold">.</span>ctime())
</span></span><span style="display:flex;"><span>    time<span style="color:#ff7b72;font-weight:bold">.</span>sleep(<span style="color:#a5d6ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 终止进程</span>
</span></span><span style="display:flex;"><span>    process_obj<span style="color:#ff7b72;font-weight:bold">.</span>terminate()
</span></span><span style="display:flex;"><span>    exit()
</span></span><span style="display:flex;"><span>out:
</span></span><span style="display:flex;"><span>    我睡两秒就结束   Thu Nov <span style="color:#a5d6ff">14</span> <span style="color:#a5d6ff">16</span>:<span style="color:#a5d6ff">04</span>:<span style="color:#a5d6ff">29</span> <span style="color:#a5d6ff">2019</span>
</span></span><span style="display:flex;"><span>    正在运行work1<span style="color:#ff7b72;font-weight:bold">...</span>Thu Nov <span style="color:#a5d6ff">14</span> <span style="color:#a5d6ff">16</span>:<span style="color:#a5d6ff">04</span>:<span style="color:#a5d6ff">29</span> <span style="color:#a5d6ff">2019</span>
</span></span><span style="display:flex;"><span>    正在运行work1<span style="color:#ff7b72;font-weight:bold">...</span>Thu Nov <span style="color:#a5d6ff">14</span> <span style="color:#a5d6ff">16</span>:<span style="color:#a5d6ff">04</span>:<span style="color:#a5d6ff">30</span> <span style="color:#a5d6ff">2019</span>
</span></span><span style="display:flex;"><span>    正在运行work1<span style="color:#ff7b72;font-weight:bold">...</span>Thu Nov <span style="color:#a5d6ff">14</span> <span style="color:#a5d6ff">16</span>:<span style="color:#a5d6ff">04</span>:<span style="color:#a5d6ff">30</span> <span style="color:#a5d6ff">2019</span>
</span></span><span style="display:flex;"><span>    正在运行work1<span style="color:#ff7b72;font-weight:bold">...</span>Thu Nov <span style="color:#a5d6ff">14</span> <span style="color:#a5d6ff">16</span>:<span style="color:#a5d6ff">04</span>:<span style="color:#a5d6ff">31</span> <span style="color:#a5d6ff">2019</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="进程线程对比">进程线程对比<a hidden class="anchor" aria-hidden="true" href="#进程线程对比">#</a></h1>
<ul>
<li>功能
<ul>
<li>进程，能够完成多任务，比如在一台电脑上能够同时运行多个<code>QQ</code></li>
<li>线程，能够完成多任务，比如一个<code>QQ</code>中的多个聊天窗口</li>
</ul>
</li>
<li>使用区别
<ul>
<li><code>进程是系统进行资源分配和调度的一个独立单位</code>。</li>
<li><code>线程是进程的一介实体，是CPU调度和分派的基本单位</code>，它是比进程更小的能独立运行的基本单位.线程自己基本上不拥有系统资源，只拥有一点在运行中必不可少的资源（如程序计数器，一组寄存器和栈），但是它可与同属一个进程的其他的线程共享进程所拥有的全部资源.</li>
<li>一个程序至少有一个进程，一个进程至少有一个线程.</li>
<li>线程的划分尺度小于进程（资源比进程少），使得多线程程序的并发性高。</li>
<li>进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率</li>
</ul>
</li>
<li>线程不能独立运行，必须依赖于线程</li>
</ul>
<table>
<thead>
<tr>
<th>对比维度</th>
<th>多进程</th>
<th>多线程</th>
<th>总结</th>
</tr>
</thead>
<tbody>
<tr>
<td>数据共享，同步</td>
<td>数据共享复杂，需要用<code>IPC</code>；数据是分开因为共享进程数据，数据共享简单</td>
<td>因为共享进程数据，数据共享简单，但也是因为这个原因导致同步复杂</td>
<td>各有千秋</td>
</tr>
<tr>
<td>内存、CPU</td>
<td>占用内存多，切换复杂，CPU利用率低</td>
<td>占用内存少，切换简单，PU利用率高CPU</td>
<td>线程占优</td>
</tr>
<tr>
<td>创建销毁、切换</td>
<td>创建销毁、切换复杂，速度慢</td>
<td>创建销毁、切换简单，速度很快</td>
<td>线程占优</td>
</tr>
<tr>
<td>编程，调试</td>
<td>编程简单，调试简单</td>
<td>编程复杂，调试复杂</td>
<td>进程占优</td>
</tr>
<tr>
<td>可靠性</td>
<td>进程间不会互相影响</td>
<td>一个线程挂掉将导致整个进程挂掉</td>
<td>进程占优</td>
</tr>
<tr>
<td>分布式</td>
<td>适应于多核、多机分布式；如果一台机器不够，扩展到多台机器比较简单</td>
<td>应用于多核分布式</td>
<td>进程占优</td>
</tr>
</tbody>
</table>
<h2 id="进程线程取舍">进程线程取舍<a hidden class="anchor" aria-hidden="true" href="#进程线程取舍">#</a></h2>
<ul>
<li>需要频繁创建销毁的先使用线程；（如：Web服务器）</li>
<li>线程的切换速度快，所以在需要大量计算，切换频繁时用线程（如图像处理、算法处理）</li>
<li>因为对CPU系统的效率使用上线程更占优，所以可能要发展到多机分布的用进程，多核分布用线程；</li>
<li>需要更稳定安全时，适合选择进程；需要速度时，选择线程更好。</li>
<li>都满足需求的情况下，用你最熟悉、最拿手的方式
需要提醒的是：虽然有这么多的选择原则，但实际应用中基本上都是“进程+线程”的结合方式</li>
<li>在Python的原始解释器CPython中存在着GlL（Global Interpreter Lock，全局解释器锁），因此在解释执行python代码时，会产生互斥锁来限制线程对共享资源的访问，直到解释器遇到I/O操作或者操作次数达到一定数目时才会释放GlL。造成了即使在多核CPU中，多线程也只是做着分时切换而已</li>
</ul>
<h1 id="消息队列">消息队列<a hidden class="anchor" aria-hidden="true" href="#消息队列">#</a></h1>
<ul>
<li>可以使用multiprocessing模块的Queue实现多进程之间的数据传递</li>
<li>Queue本身是一个消息列队程序</li>
</ul>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">multiprocessing</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 创建队列(指定长度)</span>
</span></span><span style="display:flex;"><span>queue <span style="color:#ff7b72;font-weight:bold">=</span> multiprocessing<span style="color:#ff7b72;font-weight:bold">.</span>Queue(<span style="color:#a5d6ff">5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 向队列中放值</span>
</span></span><span style="display:flex;"><span>queue<span style="color:#ff7b72;font-weight:bold">.</span>put(<span style="color:#a5d6ff">&#34;Luenci&#34;</span>)
</span></span><span style="display:flex;"><span>queue<span style="color:#ff7b72;font-weight:bold">.</span>put(<span style="color:#a5d6ff">1</span>)
</span></span><span style="display:flex;"><span>queue<span style="color:#ff7b72;font-weight:bold">.</span>put([<span style="color:#a5d6ff">5</span>, <span style="color:#a5d6ff">2</span>])
</span></span><span style="display:flex;"><span>queue<span style="color:#ff7b72;font-weight:bold">.</span>put((<span style="color:#a5d6ff">9</span>, <span style="color:#a5d6ff">8</span>, <span style="color:#a5d6ff">7</span>))
</span></span><span style="display:flex;"><span>queue<span style="color:#ff7b72;font-weight:bold">.</span>put({<span style="color:#a5d6ff">&#34;a&#34;</span>: <span style="color:#a5d6ff">6</span>, <span style="color:#a5d6ff">&#34;b&#34;</span>: <span style="color:#a5d6ff">8</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 判断队列是否全满</span>
</span></span><span style="display:flex;"><span>isfull <span style="color:#ff7b72;font-weight:bold">=</span> queue<span style="color:#ff7b72;font-weight:bold">.</span>full()
</span></span><span style="display:flex;"><span>print(<span style="color:#a5d6ff">&#34;队列为全满：&#34;</span>, isfull)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 长度为5，放入第6个数据后，队列就进行入了阻塞状态，默认会等待以列先取出值再放入新的值</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># queue.put(22)</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 不等待的放入</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># queue.put_nowait(11)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 向队列中取值</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 当队列为空的时候，再取值的时候，程序会进行阻塞状态，等待队列中有值再取</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>value <span style="color:#ff7b72;font-weight:bold">=</span> queue<span style="color:#ff7b72;font-weight:bold">.</span>get()
</span></span><span style="display:flex;"><span>print(value)
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 当队列为空的时候，再取值的时候，程序会直接报错</span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># value = queue.get_nowait()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 队列元素个数</span>
</span></span><span style="display:flex;"><span>num <span style="color:#ff7b72;font-weight:bold">=</span> queue<span style="color:#ff7b72;font-weight:bold">.</span>qsize()
</span></span><span style="display:flex;"><span>print(num)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b949e;font-style:italic"># 判断队列是否为空</span>
</span></span><span style="display:flex;"><span>empty <span style="color:#ff7b72;font-weight:bold">=</span> queue<span style="color:#ff7b72;font-weight:bold">.</span>empty()
</span></span><span style="display:flex;"><span>print(<span style="color:#a5d6ff">&#34;队列为空？：&#34;</span>, empty)
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="进程池">进程池<a hidden class="anchor" aria-hidden="true" href="#进程池">#</a></h1>
<ul>
<li>进程池概述</li>
<li>当需要创建的子进程数量不多时，可以直接利用multiprocessing中的Process动态成生多个进程，但如果是上百甚至上千个目标，手动的去创建进程的工作量巨大，此时就可以用到multiprocessing模块提供的Pool方法。</li>
</ul>
<p><img loading="lazy" src="https://i.postimg.cc/wMY848xp/image-20191114203943978.png" alt="image-20191114203943978"  />
</p>
<ul>
<li>初始化Pool时，可以指定一个最大进程数，当有新的请求提交到Pool中时，如果池还没有满，那么就会创建一个新的进程用来执行该请求；但如果池中的进程数已经达到指定的最大值，那么该请求就会等待，直到池中有进程结束，才会用之前的进程来执行新的任务。</li>
</ul>
<h2 id="进程池实现方式">进程池实现方式<a hidden class="anchor" aria-hidden="true" href="#进程池实现方式">#</a></h2>
<ul>
<li>同步方式：<code>pool.apply()</code></li>
<li>异步方式<code>pool.apply_async（copy_work）</code></li>
</ul>
<h2 id="核心方法">核心方法<a hidden class="anchor" aria-hidden="true" href="#核心方法">#</a></h2>
<ul>
<li><code>multiprocessing.Pool</code>常用函数解析：
<ul>
<li>apply（）：&ndash;进程池中进程以同步方式执行任务</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://i.postimg.cc/SR4Q2zMC/image-20191114204338304.png" alt="image-20191114204338304"  />
</p>
<ul>
<li><code>apply_async（func[，args[，kwds]]）</code>：&ndash;使用非阻塞方式调用<code>func</code>（并行执行，堵塞方式必须等待上一个进程退出才能执行下一个进程），<code>args</code>为传递给<code>func</code>的参数列表，<code>kwds</code>为传递给<code>func</code>的关键字参数列表</li>
</ul>
<p><img loading="lazy" src="https://i.postimg.cc/vTGgRKXJ/image-20191114204556059.png" alt="image-20191114204556059"  />
</p>
<h1 id="进程池中的进程通信">进程池中的进程通信<a hidden class="anchor" aria-hidden="true" href="#进程池中的进程通信">#</a></h1>
<div class="highlight"><div style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#737679">67
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">multiprocessing</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">write_queue</span>(queue):
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">for</span> i <span style="color:#ff7b72;font-weight:bold">in</span> range(<span style="color:#a5d6ff">10</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">if</span> queue<span style="color:#ff7b72;font-weight:bold">.</span>full():
</span></span><span style="display:flex;"><span>            print(<span style="color:#a5d6ff">&#34;队列已满&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">else</span>:
</span></span><span style="display:flex;"><span>            queue<span style="color:#ff7b72;font-weight:bold">.</span>put(i)
</span></span><span style="display:flex;"><span>            print(<span style="color:#a5d6ff">&#34;成功添加：&#34;</span>, i)
</span></span><span style="display:flex;"><span>            time<span style="color:#ff7b72;font-weight:bold">.</span>sleep(<span style="color:#a5d6ff">0.5</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">read_queue</span>(queue):
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">while</span> <span style="color:#79c0ff">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">if</span> queue<span style="color:#ff7b72;font-weight:bold">.</span>qsize() <span style="color:#ff7b72;font-weight:bold">==</span> <span style="color:#a5d6ff">0</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#a5d6ff">&#34;队列已空&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">break</span>
</span></span><span style="display:flex;"><span>        value <span style="color:#ff7b72;font-weight:bold">=</span> queue<span style="color:#ff7b72;font-weight:bold">.</span>get()
</span></span><span style="display:flex;"><span>        print(<span style="color:#a5d6ff">&#34;已经读取&#34;</span>, value)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">if</span> __name__ <span style="color:#ff7b72;font-weight:bold">==</span> <span style="color:#a5d6ff">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 创建进程池</span>
</span></span><span style="display:flex;"><span>    pool <span style="color:#ff7b72;font-weight:bold">=</span> multiprocessing<span style="color:#ff7b72;font-weight:bold">.</span>Pool(<span style="color:#a5d6ff">3</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 创建进程池中的队列</span>
</span></span><span style="display:flex;"><span>    queue <span style="color:#ff7b72;font-weight:bold">=</span> multiprocessing<span style="color:#ff7b72;font-weight:bold">.</span>Manager()<span style="color:#ff7b72;font-weight:bold">.</span>Queue(<span style="color:#a5d6ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 同步的方式执行</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># pool.apply(write_queue, args=(queue,))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># pool.apply(read_queue, args=(queue,))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 异步的方式执行</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># apply_async（）返回值ApplyResult对象，该对象有一个wait（）的方法</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#ff7b72;font-weight:bold">=</span> pool<span style="color:#ff7b72;font-weight:bold">.</span>apply_async(write_queue, args<span style="color:#ff7b72;font-weight:bold">=</span>(queue,))
</span></span><span style="display:flex;"><span>    result<span style="color:#ff7b72;font-weight:bold">.</span>wait()
</span></span><span style="display:flex;"><span>    pool<span style="color:#ff7b72;font-weight:bold">.</span>apply_async(read_queue, args<span style="color:#ff7b72;font-weight:bold">=</span>(queue,))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># 不再接收新的任务</span>
</span></span><span style="display:flex;"><span>    pool<span style="color:#ff7b72;font-weight:bold">.</span>close()
</span></span><span style="display:flex;"><span>    pool<span style="color:#ff7b72;font-weight:bold">.</span>join()
</span></span><span style="display:flex;"><span>out:
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">2</span>
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">3</span>
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">4</span>
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">5</span>
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">6</span>
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">7</span>
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">8</span>
</span></span><span style="display:flex;"><span>    成功添加<span style="color:#f85149">：</span> <span style="color:#a5d6ff">9</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">0</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">1</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">2</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">3</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">4</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">5</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">6</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">7</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">8</span>
</span></span><span style="display:flex;"><span>    已经读取 <span style="color:#a5d6ff">9</span>
</span></span><span style="display:flex;"><span>    队列已空
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://Lucareful.github.io/en/tags/%E8%BF%9B%E7%A8%8B%E6%A6%82%E5%BF%B5/">进程概念</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://Lucareful.github.io/en/posts/%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E5%8D%8F%E7%A8%8B%E5%AF%B9%E6%AF%94/">
    <span class="title">« Prev</span>
    <br>
    <span>python的进程，线程和协程对比</span>
  </a>
  <a class="next" href="https://Lucareful.github.io/en/posts/%E9%97%AD%E5%8C%85%E5%92%8C%E8%A3%85%E9%A5%B0%E5%99%A8/">
    <span class="title">Next »</span>
    <br>
    <span>python的闭包和装饰器</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share python的进程概念 on x"
            href="https://x.com/intent/tweet/?text=python%e7%9a%84%e8%bf%9b%e7%a8%8b%e6%a6%82%e5%bf%b5&amp;url=https%3a%2f%2fLucareful.github.io%2fen%2fposts%2f%25E5%25A4%259A%25E8%25BF%259B%25E7%25A8%258B%2f&amp;hashtags=%e8%bf%9b%e7%a8%8b%e6%a6%82%e5%bf%b5">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share python的进程概念 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fLucareful.github.io%2fen%2fposts%2f%25E5%25A4%259A%25E8%25BF%259B%25E7%25A8%258B%2f&amp;title=python%e7%9a%84%e8%bf%9b%e7%a8%8b%e6%a6%82%e5%bf%b5&amp;summary=python%e7%9a%84%e8%bf%9b%e7%a8%8b%e6%a6%82%e5%bf%b5&amp;source=https%3a%2f%2fLucareful.github.io%2fen%2fposts%2f%25E5%25A4%259A%25E8%25BF%259B%25E7%25A8%258B%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share python的进程概念 on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fLucareful.github.io%2fen%2fposts%2f%25E5%25A4%259A%25E8%25BF%259B%25E7%25A8%258B%2f&title=python%e7%9a%84%e8%bf%9b%e7%a8%8b%e6%a6%82%e5%bf%b5">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share python的进程概念 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fLucareful.github.io%2fen%2fposts%2f%25E5%25A4%259A%25E8%25BF%259B%25E7%25A8%258B%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share python的进程概念 on whatsapp"
            href="https://api.whatsapp.com/send?text=python%e7%9a%84%e8%bf%9b%e7%a8%8b%e6%a6%82%e5%bf%b5%20-%20https%3a%2f%2fLucareful.github.io%2fen%2fposts%2f%25E5%25A4%259A%25E8%25BF%259B%25E7%25A8%258B%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share python的进程概念 on telegram"
            href="https://telegram.me/share/url?text=python%e7%9a%84%e8%bf%9b%e7%a8%8b%e6%a6%82%e5%bf%b5&amp;url=https%3a%2f%2fLucareful.github.io%2fen%2fposts%2f%25E5%25A4%259A%25E8%25BF%259B%25E7%25A8%258B%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share python的进程概念 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=python%e7%9a%84%e8%bf%9b%e7%a8%8b%e6%a6%82%e5%bf%b5&u=https%3a%2f%2fLucareful.github.io%2fen%2fposts%2f%25E5%25A4%259A%25E8%25BF%259B%25E7%25A8%258B%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>
            <a id="running-time"></a>
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span id="busuanzi_container">
                <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
                👁️‍🗨️访客人数: <span id="busuanzi_value_site_uv"></span>|
                🌐访问量: <span id="busuanzi_value_site_pv"></span>
            </span>
        </span>
        <br/>
        <span>&copy; 2024 <a href="https://Lucareful.github.io/en/">Luenci</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

    const RunningTimerInterval = 1000;
    const StartTime = new Date("10/11/2018 00:00:00");

    function prefixZero(num)
    {
        if (num < 10)
        {
            num = "0" + num;
        }
        return num;
    }

function updateTime()
{
    const currentTime = new Date();
    let runningTime = currentTime.getTime() - StartTime.getTime();

    const dayMs = 24 * 60 * 60 * 1000;
    const runningDays = Math.floor(runningTime / dayMs);

    runningTime -= runningDays * dayMs;

    const hourMs = 60 * 60 * 1000;
    const runningHours = Math.floor(runningTime / hourMs);

    runningTime -= runningHours * hourMs;

    const minuteMs = 60 * 1000;
    const runningMinutes = Math.floor(runningTime / minuteMs);

    runningTime -= runningMinutes * minuteMs;

    const runningSeconds = Math.floor(runningTime / 1000);

    

    const showTime = document.getElementById("running-time");

    showTime.innerText ="🕚: " +
        runningDays + "天" + prefixZero(runningHours) + "小时" + prefixZero(runningMinutes) + "分" + prefixZero(runningSeconds) + "秒";
    }

    document.addEventListener('DOMContentLoaded', () => { let RunningTimer = setInterval(updateTime, RunningTimerInterval); });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script></body>

</html>
